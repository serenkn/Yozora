<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
    <meta charset="UTF-8">
    <title>ÊôØËâ≤‰∏ÄË¶ß</title>
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js" defer></script>
    <script th:src="@{/js/post.js}" defer></script>
    <script>
        window.addEventListener("pageshow", function (event) {
            if (event.persisted) {
                location.reload();
            }
        });
    </script>

</head>

<body>
    <main>
        <header>
            <!-- ‰∏¶„Å≥Êõø„Åà„Çø„Éñ -->
            <div class="sort-tabs">
                <a th:href="/scenery" class="sort-tab">ÊúÄÊñ∞È†Ü</a>
                <a th:href="/scenery/popular" class="sort-tab">‰∫∫Ê∞óÈ†Ü</a>
                <a th:href="/scenery/random" class="sort-tab">„É©„É≥„ÉÄ„É†È†Ü</a>
                <a th:href="/scenery/oldest" class="sort-tab">ÈÅéÂéªÈ†Ü</a>
            </div>
        </header>

        <!-- ÊäïÁ®ø‰∏ÄË¶ß -->
        <section class="post-list">
            <!-- ÊäïÁ®ø„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆË°®Á§∫ -->
            <div class="no-posts" th:if="${postList == null or postList.isEmpty()}">
                <p>ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
            </div>

            <!-- ÊäïÁ®ø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆË°®Á§∫ -->
            <div class="posts-container" th:if="${postList != null and !postList.isEmpty()}">
                <div th:each="post : ${postList}" class="post-item">

                    <!-- ÁîªÂÉèË§áÊï∞ÊûöË°®Á§∫ -->
                    <div class="swiper post-carousel" th:if="${post.imageUrls != null}">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" th:each="img : ${post.imageUrls}">
                                <img th:src="${img}" alt="ÊäïÁ®øÁîªÂÉè" class="carousel-image">
                            </div>
                        </div>
                        <div class="swiper-pagination"></div>
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-button-next"></div>
                    </div>

                    <!-- „Çø„Ç§„Éà„É´ -->
                    <p class="post-title" th:text="${post.title}"></p>

                    <!-- ÊäïÁ®øÊó•ÊôÇ -->
                    <p class="post-date" th:text="${#temporals.format(post.createdAt, 'yyyy/MM/dd HH:mm')}"></p>

                    <!-- „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ -->
                    <button class="likeBtn" th:data-post-id="${post.id}" th:data-liked="${post.liked}"
                        th:onclick="|toggleLike(this)|">
                        <span th:if="${post.liked}">‚≠ê</span>
                        <span th:unless="${post.liked}">‚òÖ</span>
                        <span id="like-count" th:text="${post.likeCount}">0</span>
                    </button>

                    <!--„ÄÄ„Ç≥„É°„É≥„ÉàÊï∞ -->
                    <p class="comments" th:text="'üí¨ ' + ${post.commentCount}">0</p>

                    <!-- „É´„Éº„Éà„Éú„Çø„É≥ -->
                    <button type="button" class="route-btn" th:if="${post.latitude != null and post.longitude != null}"
                        th:onclick="|openGoogleMapsRoute(${post.latitude}, ${post.longitude})|">
                        üìç„É´„Éº„Éà
                    </button>

                    <!-- Êú¨Êñá -->
                    <p class="post-text" th:text="${post.text}"></p>

                    <!-- ‰ΩèÊâÄ -->
                    <p class="post-address" th:text="${post.address}"></p>

                    <!-- Ë©≥Á¥∞„Éö„Éº„Ç∏„Å∏ -->
                    <form action="/post" class="detail-link">
                        <input type="hidden" name="id" th:value="${post.id}"></input>
                        <button type="submit">Ë©≥Á¥∞„ÅØ„Åì„Å°„Çâ„Å∏</button>
                    </form>
                    <!-- „Ç≥„É°„É≥„ÉàÊï∞ -->
                    <div class="comment-summary">
                        üí¨ „Ç≥„É°„É≥„Éà <span th:text="${post.commentList.size()}">0</span>‰ª∂
                    </div>

                    <!-- „Ç≥„É°„É≥„ÉàÊäïÁ®ø„Éï„Ç©„Éº„É† -->
                    <form th:action="@{/comment/add}" th:object="${commentForm}" method="post" class="comment-form">
                        <input type="hidden" th:field="*{postId}">
                        <input type="text" th:field="*{text}" placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ">
                        <button type="submit">ÊäïÁ®ø</button>
                    </form>

                    <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
                    <div class="comment-section">
                        <div class="comment" th:each="comment : ${post.commentList}">
                            <div class="comment-header">
                                <img th:src="@{${comment.profileImage}}" alt="„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè" class="comment-icon">
                                <span class="comment-username" th:text="${comment.userName}"></span>
                            </div>

                            <div class="comment-body" th:text="${comment.text}"></div>

                            <!-- Ëá™ÂàÜ„ÅÆ„Ç≥„É°„É≥„Éà„ÅÆ„ÅøÁ∑®ÈõÜ„ÉªÂâäÈô§Ë°®Á§∫ -->
                            <div th:if="${comment.userId == post.loginUserId}" class="comment-actions">
                                <button type="button" th:data-id="${comment.id}"
                                    onclick="openEditModal(this)">Á∑®ÈõÜ</button>
                                <form th:action="@{/comment/delete}" method="post">
                                    <input type="hidden" name="commentId" th:value="${comment.id}"></input>
                                    <button type="submit">ÂâäÈô§</button>
                                </form>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </main>

    <!-- „Éï„ÉÉ„Çø„Éº -->
    <div th:replace="~{fragments/footer :: footer}"></div>

</body>

</html>