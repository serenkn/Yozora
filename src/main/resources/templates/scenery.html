<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
    <meta charset="UTF-8">
    <title>ÊôØËâ≤‰∏ÄË¶ß</title>
    <link rel="stylesheet" th:href="@{/css/scenery.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js" defer></script>
    <script th:src="@{/js/post.js}" defer></script>
    <script>
        window.addEventListener("pageshow", function (event) {
            if (event.persisted) {
                location.reload();
            }
        });
    </script>
</head>

<body>
    <main>
        <header>
            <!-- ‰∏¶„Å≥Êõø„Åà„Çø„Éñ -->
            <div class="sort-tabs">
                <a th:href="@{/scenery}" class="sort-tab">ÊúÄÊñ∞È†Ü</a>
                <a th:href="@{/scenery/popular}" class="sort-tab">‰∫∫Ê∞óÈ†Ü</a>
                <a th:href="@{/scenery/random}" class="sort-tab">„É©„É≥„ÉÄ„É†È†Ü</a>
                <a th:href="@{/scenery/oldest}" class="sort-tab">ÈÅéÂéªÈ†Ü</a>
            </div>
        </header>

        <!-- „Ç≥„É°„É≥„Éà„É¢„Éº„ÉÄ„É´Áî® -->
        <input type="hidden" id="loginUserId" th:value="${user.id}">

        <!-- ÊäïÁ®ø‰∏ÄË¶ß -->
        <section class="post-list">
            <!-- ÊäïÁ®ø„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆË°®Á§∫ -->
            <div class="no-posts" th:if="${postList == null or postList.isEmpty()}">
                <p>ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
            </div>

            <!-- ÊäïÁ®ø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆË°®Á§∫ -->
            <div class="posts-container" th:if="${postList != null and !postList.isEmpty()}">
                <div th:each="post : ${postList}" class="post-item" th:attr="data-post-id=${post.id}">

                    <!-- ÊäïÁ®øËÄÖÊÉÖÂ†± -->
                    <div class="user-info">
                        <img th:src="@{${post.profileImage}}" class="user-icon" alt="„Ç¢„Ç§„Ç≥„É≥">
                        <span th:text="${post.userName}"></span>
                    </div>

                    <!-- „Çø„Ç§„Éà„É´ -->
                    <p class="post-title" th:text="${post.title}"></p>

                    <!-- ÁîªÂÉèË§áÊï∞ÊûöË°®Á§∫ -->
                    <div class="swiper post-carousel" th:if="${post.imageUrls != null}">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" th:each="img : ${post.imageUrls}">
                                <img th:src="${img}" alt="ÊäïÁ®øÁîªÂÉè" class="carousel-image">
                            </div>
                        </div>
                        <div class="swiper-pagination"></div>
                        <div class="swiper-button-prev"></div>
                        <div class="swiper-button-next"></div>
                    </div>


                    <div class="post-meta">
                        <!-- ÊäïÁ®øÊó•ÊôÇ -->
                        <p class="post-time date-time" th:text="${post.createdAt}"></p>

                        <div class="post-actions">
                            <!-- „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ -->
                            <button class="likeBtn" th:data-post-id="${post.id}" th:data-liked="${post.liked}"
                                th:onclick="|toggleLike(this)|">
                                <span th:if="${post.liked}">‚≠ê</span>
                                <span th:unless="${post.liked}">‚òÖ</span>
                                <span id="like-count" th:text="${post.likeCount}">0</span>
                            </button>

                            <!-- „Ç≥„É°„É≥„ÉàÊï∞Ôºà„ÇØ„É™„ÉÉ„ÇØ„Åß„É¢„Éº„ÉÄ„É´Ôºâ -->
                            <div class="commentBtn" th:data-post-id="${post.id}" th:data-count="${post.commentCount}"
                                onclick="openCommentModal(this)">
                                üí¨<span th:text="${post.commentCount}">0</span>
                            </div>

                            <!-- ÂêÑÊäïÁ®ø„ÅÆ„Ç≥„É°„É≥„Éà„É™„Çπ„Éà„Çí JSON Âüã„ÇÅËæº„ÅøÔºàÂêå„Åò„Ç´„Éº„ÉâÂÜÖ„ÅßOKÔºâ -->
                            <script type="application/json" th:id="|comments-${post.id}|"
                                th:inline="javascript">/*[[${post.commentList}]]*/</script>

                            <!-- „É´„Éº„Éà„Éú„Çø„É≥ -->
                            <button type="button" class="route-btn"
                                th:if="${post.latitude != null and post.longitude != null}"
                                th:onclick="|openGoogleMapsRoute(${post.latitude}, ${post.longitude})|">
                                üìç„É´„Éº„Éà
                            </button>
                        </div>
                    </div>

                    <!-- Êú¨Êñá -->
                    <p class="post-text" th:text="${post.text}"></p>

                    <!-- ‰ΩèÊâÄ -->
                    <p class="post-address" th:text="${post.address}"></p>

                    <!-- Ë©≥Á¥∞„Éö„Éº„Ç∏„Å∏ -->
                    <form action="/post" class="detail-link">
                        <input type="hidden" name="id" th:value="${post.id}">
                        <button type="submit">Ë©≥Á¥∞„ÅØ„Åì„Å°„Çâ„Å∏</button>
                    </form>

                </div>
            </div>

        </section>
    </main>

    <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß„É¢„Éº„ÉÄ„É´ -->
    <div id="commentModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <span class="comment-count">üí¨ „Ç≥„É°„É≥„Éà <span id="cm-count">0</span>‰ª∂</span>
                <button type="button" class="modal-close" onclick="closeCommentModal()">‚úï</button>
            </div>

            <div id="cm-list" class="comment-list"></div>

            <form th:action="@{/comment/add}" method="post" class="comment-form">
                <input type="hidden" name="postId" id="cm-postId">
                <input type="text" name="text" placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ" required>
                <button type="submit">ÈÄÅ‰ø°</button>
            </form>
        </div>
    </div>

    <!-- „Ç≥„É°„É≥„ÉàÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div id="editModal" class="modal">
        <form th:action="@{/comment/edit}" th:object="${commentForm}" method="post">

            <input type="hidden" name="id" id="editCommentId"></input>

            <input type="text" name="text" id="editCommentText" class="edit-text">

            <div class="modal-action">
                <button type="button" class="btn-cancel" onclick="closeEditModal()">Á†¥Ê£Ñ</button>
                <button type="submit" class="btn-save">‰øùÂ≠ò</button>
            </div>

        </form>
    </div>

    <!-- „Éï„ÉÉ„Çø„Éº -->
    <div th:replace="~{fragments/footer :: footer}"></div>

</body>

</html>