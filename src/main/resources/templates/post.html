<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
    <meta charset="UTF-8">
    <title>ÊäïÁ®øË©≥Á¥∞</title>
    <link rel="stylesheet" href="/css/post_detail.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
</head>

<body data-page="detail">
    <main>
        <!-- Êàª„Çã„Éú„Çø„É≥ -->
        <button onclick="history.back()">‚Üê Êàª„Çã</button>

        <!-- ÊäïÁ®øËÄÖÊÉÖÂ†± -->
        <div class="user-info">
            <img th:src="@{${post.profileImage}}" class="user-icon" alt="„Ç¢„Ç§„Ç≥„É≥">
            <span th:text="${post.userName}"></span>
        </div>

        <!-- Swiper„Ç´„É´„Éº„Çª„É´ -->
        <div class="swiper">
            <div class="swiper-wrapper" id="carousel-wrapper">
                <div class="swiper-slide" th:each="url : ${post.imageUrls}">
                    <img th:src="@{${url}}" class="post-image" alt="ÊäïÁ®øÁîªÂÉè">
                </div>
            </div>
        </div>

        <!-- ÊäïÁ®øÊó•„Éª„ÅÑ„ÅÑ„Å≠„Éª„Ç≥„É°„É≥„Éà„Éª„É´„Éº„Éà -->
        <div class="meta-info">

            <!-- ÊäïÁ®øÊó•-->
            <p class="post-date" th:text="${#temporals.format(post.createdAt, 'yyyy/MM/dd HH:mm')}"></p>

            <!-- „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ -->
            <button class="likeBtn" th:data-post-id="${post.id}" th:data-liked="${post.liked}"
                th:onclick="|toggleLike(this)|">
                <span th:if="${post.liked}">‚≠ê</span>
                <span th:unless="${post.liked}">‚òÖ</span>
                <span id="like-count" th:text="${post.likeCount}">0</span>
            </button>

            <!-- „Ç≥„É°„É≥„ÉàÊï∞„ÄÄ-->
            <div class="comment-summary">
                üí¨<span th:text="${post.commentList.size()}">0</span>
            </div>
            <!-- „É´„Éº„Éà„Éú„Çø„É≥ -->
            <button type="button" class="route-btn" th:if="${post.latitude != null and post.longitude != null}"
                th:onclick="|openGoogleMapsRoute(${post.latitude}, ${post.longitude})|">
                üìç„É´„Éº„Éà
            </button>

            <!-- „Çø„Ç§„Éà„É´„ÉªÊú¨Êñá„Éª‰ΩèÊâÄ -->
            <h2 th:text="${post.title}"></h2>
            <p th:text="${post.text}"></p>
            <div class="post-address" th:text="${post.address}"></div>

            <!-- Á∑®ÈõÜ„Éú„Çø„É≥ÔºàËá™ÂàÜ„ÅÆÊäïÁ®ø„ÅÆ„ÅøÔºâ -->
            <div th:if="${isMyPost}" class="edit-area">
                <a th:href="@{'/post/edit/' + ${post.id}}" class="edit-button">‚úèÔ∏è Á∑®ÈõÜ„Åô„Çã</a>
            </div>

            <!-- „Ç≥„É°„É≥„ÉàÊï∞ -->
            <div class="comment-summary">
                üí¨ „Ç≥„É°„É≥„Éà <span th:text="${post.commentList.size()}">0</span>‰ª∂
            </div>

            <!-- „Ç≥„É°„É≥„ÉàÊäïÁ®ø„Éï„Ç©„Éº„É† -->
            <form th:action="@{/comment/add}" th:object="${commentForm}" method="post" class="comment-form">
                <input type="hidden" th:field="*{postId}">
                <input type="text" th:field="*{text}" placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ">
                <button type="submit">ÊäïÁ®ø</button>
            </form>

            <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
            <div class="comment-section">
                <div class="comment" th:each="comment : ${post.commentList}">
                    <div class="comment-header">
                        <img th:src="@{${comment.profileImage}}" alt="„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè" class="comment-icon">
                        <span class="comment-username" th:text="${comment.userName}"></span>
                    </div>

                    <div class="comment-body" th:text="${comment.text}"></div>

                    <!-- Ëá™ÂàÜ„ÅÆ„Ç≥„É°„É≥„Éà„ÅÆ„ÅøÁ∑®ÈõÜ„ÉªÂâäÈô§Ë°®Á§∫ -->
                    <div th:if="${comment.userId == post.loginUserId}" class="comment-actions">
                        <button type="button" th:data-id="${comment.id}" onclick="openEditModal(this)">Á∑®ÈõÜ</button>
                        <form th:action="@{/comment/delete}" method="post">
                            <input type="hidden" name="commentId" th:value="${comment.id}"></input>
                            <button type="submit">ÂâäÈô§</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </main>

    <!-- „Ç≥„É°„É≥„ÉàÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div id="editModal" class="modal">
        <form th:action="@{/comment/edit}" method="post">
            <input type="hidden" id="editCommentId" name="commentId">
            <textarea id="editCommentText" name="commentText" required></textarea>
            <button type="submit">‰øùÂ≠ò</button>
            <button type="button" onclick="closeEditModal()">„Ç≠„É£„É≥„Çª„É´</button>
        </form>
    </div>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="/js/script.js"></script>
    <script th:src="@{/js/post.js}" defer></script>
    <script>
        window.addEventListener("pageshow", function (event) {
            if (event.persisted) {
                // Â±•Ê≠¥„Ç≠„É£„ÉÉ„Ç∑„É•„Åã„ÇâÊàª„Å£„ÅüÊôÇ„Å´„É™„É≠„Éº„Éâ„Åô„Çã
                location.reload();
            }
        });
    </script>
</body>

</html>